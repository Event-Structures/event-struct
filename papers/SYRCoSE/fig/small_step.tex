\begin{figure*}[!t]
  \begin{prooftree}
    \AXC{$\tmap(\es.fr) = (\st, t)$}
    \AXC{$\st, p[\es.tid] \xRightarrow{\text{ThreadStart}} \st'$}
    \RightLabel{$\to$ThreadStart}
    \BIC{$\la \es, \tmap \ra \rightarrow \la \es + \la \text{ThreadStart} \ra, \tmap[es.fr \leftarrow \st'] \ra$}
  \end{prooftree}

  \begin{prooftree}
    \AXC{$pr \in \es.E$}
    \AXC{$\tmap(pr) = (\st, t)$}
    \AXC{$\st, p[t] \xRightarrow{\_} \st'$}
    \RightLabel{$\to\_$}
    \TIC{$\la \es, \tmap \ra \rightarrow \la \es, \tmap[pr \leftarrow \st'] \ra$}
  \end{prooftree}
  \begin{prooftree}
    \AXC{$pr \in \es.E$}
    \AXC{$\tmap(pr) = (\st, t)$}
    \AXC{$\st, p[t] \xRightarrow{\wlab{x}{i}} \st'$}
    \RightLabel{$\to \wlab{x}{i}$}
    \TIC{$\la \es, \tmap \ra \rightarrow \la \es + \la \wlab{x}{i}, \ pr \ra, \tmap[\es.fr \leftarrow (\st',t)] \ra$}
  \end{prooftree}
  \begin{prooftree}
    \AXC{$pr,w \in \es.E$}
    \AXC{$\tmap(pr) = (\st, t)$}
    \AXC{$\st, p[t]\xRightarrow{\rlab{x}{\_}} \st'$}
    \AXC{$\rlab{x}{i} \ll \es.\ffun{lab}(w)$}
    \RightLabel{$\to \rlab{x}{i}$}
    \QuaternaryInfC{$\la \es, \tmap \ra \rightarrow \la \es + \la \rlab{x}{i}, \ pr, \ w \ra, \tmap[\es.fr \leftarrow (\st'(i),t) ]\ra$}
  \end{prooftree}
  \begin{prooftree}
    \AXC{$consistent (\es')$}
    \AXC{$\la \es, \tmap \ra \to \la \es', \tmap' \ra$}
    \RightLabel{small-step}
    \BIC{$\la \es, \tmap \ra \Rightarrow \la \es', \tmap' \ra$}
  \end{prooftree}
  \caption{Small-step semantics}
  \label{fig:smallstep}
\end{figure*}
